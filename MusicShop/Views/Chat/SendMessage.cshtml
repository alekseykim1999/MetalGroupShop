
@{
    Layout = null;
}

@model ChatViewModel
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="~/lib/signalr/dist/browser/signalr.js"></script>
    <title>Chat</title>
</head>
<body>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/Message")
            .build();
        connection.start()
            .catch(err => alert(err.toString()));
    </script>
    <script>
        $(document).ready(function () {
            $("#btnSend").click(function (e) {
                let message = $('#messagebox').val();
                let sender = $('#senderUId').text();
                $('#messagebox').val('');
                connection.invoke('SendMessage', sender, message)
                e.preventDefault();

                let nameElement = document.createElement('strong');
                nameElement.innerText = `${sender}:`;
                let msgElement = document.createElement('em');
                msgElement.innerText = ` ${message}`;
                let li = document.createElement('li');
                li.appendChild(nameElement);
                li.appendChild(msgElement);
                $('#messageList').append(li);
            });
        });


        function appendLine(uid, message) {
            let nameElement = document.createElement('strong');
            nameElement.innerText = `${uid}:`;
            let msgElement = document.createElement('em');
            msgElement.innerText = ` ${message}`;
            let li = document.createElement('li');
            li.appendChild(nameElement);
            li.appendChild(msgElement);
            $('#messageList').append(li);
        };
    </script>
    <div class="signalr-demo">
        <div id="senderUId">@Model.SessionKey</div>
        <form id="messageform">
            <input type="text" id="messagebox" />
            <input type="button" value="Send Message" id="btnSend" />
        </form>
        <hr />
        <ul id="messageList" style="text-align:left;"></ul>
    </div>
</body>

</html>
